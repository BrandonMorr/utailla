<?php
/**
 * @file
 * Main hooks.
 */

// Objects.
define('UTAILLA_COLLECTION', 'ailla:collection_collection');
// Migrations.
define('UTAILLA_USER_MIGRATION', 'UtaillaUser');

/**
 * Implements hook_islandora_required_objects().
 */
function utailla_islandora_required_objects(IslandoraTuque $connection) {
  module_load_include('inc', 'utailla', 'includes/utilities');
  $module_path = drupal_get_path('module', 'utailla');

  $language_cmodel = $connection->repository->constructObject('ailla:languageCModel');
  $language_cmodel->owner = 'fedoraAdmin';
  $language_cmodel->label = 'Ailla Language Content Model';
  $language_cmodel->models = 'fedora-system:ContentModel-3.0';
  // DS-COMPOSITE-MODEL Datastream.
  $datastream = $language_cmodel->constructDatastream('DS-COMPOSITE-MODEL', 'X');
  $datastream->label = 'DS-COMPOSITE-MODEL';
  $datastream->mimetype = 'application/xml';
  $datastream->setContentFromFile("$module_path/xml/language_composite_model.xml", FALSE);
  $language_cmodel->ingestDatastream($datastream);

  $language_collection = $connection->repository->constructObject('ailla:language_collection');
  $language_collection->owner = 'fedoraAdmin';
  $language_collection->label = 'Language Collection';
  $language_collection->models = 'islandora:collectionCModel';
  $language_collection->relationships->add(FEDORA_RELS_EXT_URI, 'isMemberOfCollection', 'islandora:root');
  // Collection Policy Datastream.
  $datastream = $language_collection->constructDatastream('COLLECTION_POLICY', 'X');
  $datastream->label = 'Collection policy';
  $datastream->mimetype = 'application/xml';
  $datastream->setContentFromFile("$module_path/xml/language_collection_policy.xml", FALSE);
  $language_collection->ingestDatastream($datastream);

  // TN Datastream.
  utailla_set_default_thumb($language_collection);

  // Country content model.
  $country_cmodel = $connection->repository->constructObject('ailla:countryCModel');
  $country_cmodel->owner = 'fedoraAdmin';
  $country_cmodel->label = 'Ailla Country Content Model';
  $country_cmodel->models = 'fedora-system:ContentModel-3.0';
  // DS-COMPOSITE-MODEL Datastream.
  $datastream = $country_cmodel->constructDatastream('DS-COMPOSITE-MODEL', 'X');
  $datastream->label = 'DS-COMPOSITE-MODEL';
  $datastream->mimetype = 'application/xml';
  $datastream->setContentFromFile("$module_path/xml/country_composite_model.xml", FALSE);
  $country_cmodel->ingestDatastream($datastream);

  $country_collection = $connection->repository->constructObject('ailla:country_collection');
  $country_collection->owner = 'fedoraAdmin';
  $country_collection->label = 'Country Collection';
  $country_collection->models = 'islandora:collectionCModel';
  $country_collection->relationships->add(FEDORA_RELS_EXT_URI, 'isMemberOfCollection', 'islandora:root');

  // Collection Policy Datastream.
  $datastream = $country_collection->constructDatastream('COLLECTION_POLICY', 'X');
  $datastream->label = 'Collection policy';
  $datastream->mimetype = 'application/xml';
  $datastream->setContentFromFile("$module_path/xml/country_collection_policy.xml", FALSE);
  $country_collection->ingestDatastream($datastream);

  // TN Datastream.
  utailla_set_default_thumb($country_collection);

  // Collection collection.
  $collection_collection = $connection->repository->constructObject(UTAILLA_COLLECTION);
  $collection_collection->owner = 'fedoraAdmin';
  $collection_collection->label = 'Collections';
  $collection_collection->models = 'islandora:collectionCModel';
  $collection_collection->relationships->add(FEDORA_RELS_EXT_URI, 'isMemberOfCollection', 'islandora:root');
  $collection_collection_policy = $collection_collection->constructDatastream('COLLECTION_POLICY', 'M');
  $collection_collection_policy->label = 'Collection Policy';
  $collection_collection_policy->mimetype = 'application/xml';
  $collection_collection_policy->setContentFromFile("$module_path/xml/collection_collection_policy.xml", FALSE);
  $collection_collection->ingestDatastream($collection_collection_policy);
  utailla_set_default_thumb($collection_collection);

  return array(
    'utailla' => array(
      'title' => t('AILLA'),
      'objects' => array(
        $language_cmodel,
        $language_collection,
        $country_cmodel,
        $country_collection,
        $collection_collection,
      ),
    ),
  );
}
